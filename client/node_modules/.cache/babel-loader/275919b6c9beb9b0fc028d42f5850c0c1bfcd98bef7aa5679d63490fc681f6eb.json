{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport axios from 'axios';\n\n// Async thunks\nexport const fetchConversations = createAsyncThunk('chat/fetchConversations', async (_, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await axios.get('/api/conversations', {\n      withCredentials: true\n    });\n    return response.data;\n  } catch (error) {\n    var _error$response, _error$response$data;\n    return rejectWithValue(((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.error) || 'Failed to fetch conversations');\n  }\n});\nexport const fetchMessages = createAsyncThunk('chat/fetchMessages', async (userId, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await axios.get(`/api/messages/${userId}`, {\n      withCredentials: true\n    });\n    return {\n      userId,\n      messages: response.data\n    };\n  } catch (error) {\n    var _error$response2, _error$response2$data;\n    return rejectWithValue(((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.error) || 'Failed to fetch messages');\n  }\n});\nconst initialState = {\n  conversations: [],\n  messages: {},\n  currentChat: null,\n  loading: false,\n  error: null,\n  wsConnected: false\n};\nconst chatSlice = createSlice({\n  name: 'chat',\n  initialState,\n  reducers: {\n    clearError: state => {\n      state.error = null;\n    },\n    setCurrentChat: (state, action) => {\n      state.currentChat = action.payload;\n    },\n    addMessage: (state, action) => {\n      // Accept both WebSocket and API message formats\n      const msg = action.payload;\n      const sender_id = msg.sender_id || msg.senderId;\n      const receiver_id = msg.receiver_id || msg.receiverId;\n      const chatKey = [sender_id, receiver_id].sort().join('-');\n      if (!state.messages[chatKey]) {\n        state.messages[chatKey] = [];\n      }\n      state.messages[chatKey].push({\n        ...msg,\n        sender_id,\n        receiver_id,\n        created_at: msg.created_at || msg.timestamp || new Date().toISOString()\n      });\n    },\n    setWebSocketStatus: (state, action) => {\n      state.wsConnected = action.payload;\n    },\n    clearMessages: state => {\n      state.messages = {};\n      state.currentChat = null;\n    }\n  },\n  extraReducers: builder => {\n    builder\n    // Fetch conversations\n    .addCase(fetchConversations.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(fetchConversations.fulfilled, (state, action) => {\n      state.loading = false;\n      state.conversations = action.payload;\n    }).addCase(fetchConversations.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    })\n    // Fetch messages\n    .addCase(fetchMessages.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(fetchMessages.fulfilled, (state, action) => {\n      state.loading = false;\n      const {\n        userId,\n        messages\n      } = action.payload;\n      // Use currentChat and logged-in user for key\n      if (state.currentChat && state.currentChat.other_user_id) {\n        const chatKey = [state.currentChat.other_user_id, state.currentChat.user_id || userId].sort().join('-');\n        state.messages[chatKey] = messages;\n      } else {\n        // fallback for initial load\n        const chatKey = [userId].sort().join('-');\n        state.messages[chatKey] = messages;\n      }\n    }).addCase(fetchMessages.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n    });\n  }\n});\nexport const {\n  clearError,\n  setCurrentChat,\n  addMessage,\n  setWebSocketStatus,\n  clearMessages\n} = chatSlice.actions;\nexport default chatSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","fetchConversations","_","rejectWithValue","response","get","withCredentials","data","error","_error$response","_error$response$data","fetchMessages","userId","messages","_error$response2","_error$response2$data","initialState","conversations","currentChat","loading","wsConnected","chatSlice","name","reducers","clearError","state","setCurrentChat","action","payload","addMessage","msg","sender_id","senderId","receiver_id","receiverId","chatKey","sort","join","push","created_at","timestamp","Date","toISOString","setWebSocketStatus","clearMessages","extraReducers","builder","addCase","pending","fulfilled","rejected","other_user_id","user_id","actions","reducer"],"sources":["C:/Users/ashit/OneDrive/Desktop/project1/client/src/store/slices/chatSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport axios from 'axios';\r\n\r\n// Async thunks\r\nexport const fetchConversations = createAsyncThunk(\r\n  'chat/fetchConversations',\r\n  async (_, { rejectWithValue }) => {\r\n    try {\r\n      const response = await axios.get('/api/conversations', { withCredentials: true });\r\n      return response.data;\r\n    } catch (error) {\r\n      return rejectWithValue(error.response?.data?.error || 'Failed to fetch conversations');\r\n    }\r\n  }\r\n);\r\n\r\nexport const fetchMessages = createAsyncThunk(\r\n  'chat/fetchMessages',\r\n  async (userId, { rejectWithValue }) => {\r\n    try {\r\n      const response = await axios.get(`/api/messages/${userId}`, { withCredentials: true });\r\n      return { userId, messages: response.data };\r\n    } catch (error) {\r\n      return rejectWithValue(error.response?.data?.error || 'Failed to fetch messages');\r\n    }\r\n  }\r\n);\r\n\r\nconst initialState = {\r\n  conversations: [],\r\n  messages: {},\r\n  currentChat: null,\r\n  loading: false,\r\n  error: null,\r\n  wsConnected: false,\r\n};\r\n\r\nconst chatSlice = createSlice({\r\n  name: 'chat',\r\n  initialState,\r\n  reducers: {\r\n    clearError: (state) => {\r\n      state.error = null;\r\n    },\r\n    setCurrentChat: (state, action) => {\r\n      state.currentChat = action.payload;\r\n    },\r\n    addMessage: (state, action) => {\r\n      // Accept both WebSocket and API message formats\r\n      const msg = action.payload;\r\n      const sender_id = msg.sender_id || msg.senderId;\r\n      const receiver_id = msg.receiver_id || msg.receiverId;\r\n      const chatKey = [sender_id, receiver_id].sort().join('-');\r\n      if (!state.messages[chatKey]) {\r\n        state.messages[chatKey] = [];\r\n      }\r\n      state.messages[chatKey].push({\r\n        ...msg,\r\n        sender_id,\r\n        receiver_id,\r\n        created_at: msg.created_at || msg.timestamp || new Date().toISOString(),\r\n      });\r\n    },\r\n    setWebSocketStatus: (state, action) => {\r\n      state.wsConnected = action.payload;\r\n    },\r\n    clearMessages: (state) => {\r\n      state.messages = {};\r\n      state.currentChat = null;\r\n    },\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      // Fetch conversations\r\n      .addCase(fetchConversations.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(fetchConversations.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.conversations = action.payload;\r\n      })\r\n      .addCase(fetchConversations.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      })\r\n      // Fetch messages\r\n      .addCase(fetchMessages.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(fetchMessages.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        const { userId, messages } = action.payload;\r\n        // Use currentChat and logged-in user for key\r\n        if (state.currentChat && state.currentChat.other_user_id) {\r\n          const chatKey = [state.currentChat.other_user_id, state.currentChat.user_id || userId].sort().join('-');\r\n          state.messages[chatKey] = messages;\r\n        } else {\r\n          // fallback for initial load\r\n          const chatKey = [userId].sort().join('-');\r\n          state.messages[chatKey] = messages;\r\n        }\r\n      })\r\n      .addCase(fetchMessages.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n      });\r\n  },\r\n});\r\n\r\nexport const { \r\n  clearError, \r\n  setCurrentChat, \r\n  addMessage, \r\n  setWebSocketStatus, \r\n  clearMessages \r\n} = chatSlice.actions;\r\n\r\nexport default chatSlice.reducer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}